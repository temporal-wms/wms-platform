asyncapi: 3.0.0
info:
  title: WMS Labor Service Events
  version: 1.0.0
  description: |
    AsyncAPI specification for Labor Service domain events.

    The Labor service publishes events to track workforce management including
    shift lifecycle, task assignments, and productivity metrics.
    Events follow the CloudEvents 1.0 specification.

    **Event Flow:**
    1. WorkerRegistered - When a new worker is created
    2. ShiftStarted - When a worker clocks in
    3. ShiftEnded - When a worker clocks out
    4. BreakStarted - When a worker starts a break
    5. BreakEnded - When a worker returns from break
    6. WorkerAssigned - When a task is assigned to a worker
    7. TaskCompleted - When a worker completes a task
    8. WorkerUnassigned - When a task is removed from a worker

    **Integration:**
    - WES listens for worker availability events
    - Routing Service queries available pickers via events
    - Analytics listens for productivity events
  contact:
    name: WMS Platform Team
    email: wms@example.com

servers:
  kafka:
    host: localhost:9092
    protocol: kafka
    description: Local Kafka broker

defaultContentType: application/json

channels:
  wms.labor.events:
    address: wms.labor.events
    description: Labor and workforce events topic (3 partitions, keyed by workerId)
    messages:
      workerRegistered:
        $ref: '#/components/messages/WorkerRegisteredEvent'
      shiftStarted:
        $ref: '#/components/messages/ShiftStartedEvent'
      shiftEnded:
        $ref: '#/components/messages/ShiftEndedEvent'
      breakStarted:
        $ref: '#/components/messages/BreakStartedEvent'
      breakEnded:
        $ref: '#/components/messages/BreakEndedEvent'
      workerAssigned:
        $ref: '#/components/messages/WorkerAssignedEvent'
      taskCompleted:
        $ref: '#/components/messages/TaskCompletedEvent'
      workerUnassigned:
        $ref: '#/components/messages/WorkerUnassignedEvent'

operations:
  publishWorkerRegistered:
    action: send
    channel:
      $ref: '#/channels/wms.labor.events'
    summary: Publish worker registered event
    description: Published when a new worker is registered in the system
    messages:
      - $ref: '#/channels/wms.labor.events/messages/workerRegistered'

  publishShiftStarted:
    action: send
    channel:
      $ref: '#/channels/wms.labor.events'
    summary: Publish shift started event
    description: Published when a worker starts their shift
    messages:
      - $ref: '#/channels/wms.labor.events/messages/shiftStarted'

  publishShiftEnded:
    action: send
    channel:
      $ref: '#/channels/wms.labor.events'
    summary: Publish shift ended event
    description: Published when a worker ends their shift
    messages:
      - $ref: '#/channels/wms.labor.events/messages/shiftEnded'

  publishBreakStarted:
    action: send
    channel:
      $ref: '#/channels/wms.labor.events'
    summary: Publish break started event
    description: Published when a worker starts a break
    messages:
      - $ref: '#/channels/wms.labor.events/messages/breakStarted'

  publishBreakEnded:
    action: send
    channel:
      $ref: '#/channels/wms.labor.events'
    summary: Publish break ended event
    description: Published when a worker returns from break
    messages:
      - $ref: '#/channels/wms.labor.events/messages/breakEnded'

  publishWorkerAssigned:
    action: send
    channel:
      $ref: '#/channels/wms.labor.events'
    summary: Publish worker assigned event
    description: Published when a worker is assigned to a task
    messages:
      - $ref: '#/channels/wms.labor.events/messages/workerAssigned'

  publishTaskCompleted:
    action: send
    channel:
      $ref: '#/channels/wms.labor.events'
    summary: Publish task completed event
    description: Published when a worker completes a task
    messages:
      - $ref: '#/channels/wms.labor.events/messages/taskCompleted'

  publishWorkerUnassigned:
    action: send
    channel:
      $ref: '#/channels/wms.labor.events'
    summary: Publish worker unassigned event
    description: Published when a task is removed from a worker
    messages:
      - $ref: '#/channels/wms.labor.events/messages/workerUnassigned'

components:
  messages:
    WorkerRegisteredEvent:
      name: WorkerRegisteredEvent
      title: Worker Registered
      summary: Published when a new worker is registered
      description: |
        Triggered when a new worker profile is created in the system.
        Contains worker details including skills and certifications.
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/WorkerRegisteredPayload'
      examples:
        - name: workerRegistered
          summary: New picker registered
          payload:
            workerId: "PICKER-001"
            name: "John Doe"
            skills: ["picking", "packing"]
            certifications: []
            registeredAt: "2024-12-24T10:00:00Z"

    ShiftStartedEvent:
      name: ShiftStartedEvent
      title: Shift Started
      summary: Published when a worker starts their shift
      description: |
        Triggered when a worker clocks in.
        Worker becomes available for task assignment.
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/ShiftStartedPayload'
      examples:
        - name: shiftStarted
          summary: Morning shift started
          payload:
            shiftId: "SHIFT-001234"
            workerId: "PICKER-001"
            zone: "zone-a"
            shiftType: "morning"
            stationId: "STATION-A1"
            startedAt: "2024-12-24T08:00:00Z"

    ShiftEndedEvent:
      name: ShiftEndedEvent
      title: Shift Ended
      summary: Published when a worker ends their shift
      description: |
        Triggered when a worker clocks out.
        Contains shift summary including productivity metrics.
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/ShiftEndedPayload'
      examples:
        - name: shiftEnded
          summary: Shift ended with metrics
          payload:
            shiftId: "SHIFT-001234"
            workerId: "PICKER-001"
            zone: "zone-a"
            startedAt: "2024-12-24T08:00:00Z"
            endedAt: "2024-12-24T16:00:00Z"
            duration: "PT8H"
            tasksCompleted: 45
            itemsProcessed: 523
            productivity: 92.5

    BreakStartedEvent:
      name: BreakStartedEvent
      title: Break Started
      summary: Published when a worker starts a break
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/BreakStartedPayload'
      examples:
        - name: breakStarted
          summary: Lunch break started
          payload:
            workerId: "PICKER-001"
            shiftId: "SHIFT-001234"
            breakType: "lunch"
            expectedDuration: 30
            startedAt: "2024-12-24T12:00:00Z"

    BreakEndedEvent:
      name: BreakEndedEvent
      title: Break Ended
      summary: Published when a worker returns from break
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/BreakEndedPayload'
      examples:
        - name: breakEnded
          summary: Lunch break ended
          payload:
            workerId: "PICKER-001"
            shiftId: "SHIFT-001234"
            breakType: "lunch"
            actualDuration: 32
            endedAt: "2024-12-24T12:32:00Z"

    WorkerAssignedEvent:
      name: WorkerAssignedEvent
      title: Worker Assigned
      summary: Published when a worker is assigned to a task
      description: |
        Triggered when a task is assigned to a worker.
        WES workflow uses this for task coordination.
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/WorkerAssignedPayload'
      examples:
        - name: workerAssigned
          summary: Picker assigned to route
          payload:
            workerId: "PICKER-001"
            taskId: "RT-a1b2c3d4"
            taskType: "picking"
            priority: 1
            assignedAt: "2024-12-24T10:05:00Z"

    TaskCompletedEvent:
      name: TaskCompletedEvent
      title: Task Completed
      summary: Published when a worker completes a task
      description: |
        Triggered when a task is completed by a worker.
        Contains task duration and items processed for productivity tracking.
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/TaskCompletedPayload'
      examples:
        - name: taskCompleted
          summary: Pick task completed
          payload:
            taskId: "RT-a1b2c3d4"
            workerId: "PICKER-001"
            taskType: "picking"
            completedAt: "2024-12-24T10:30:00Z"
            duration: 1500
            itemsProcessed: 15

    WorkerUnassignedEvent:
      name: WorkerUnassignedEvent
      title: Worker Unassigned
      summary: Published when a task is removed from a worker
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/WorkerUnassignedPayload'
      examples:
        - name: workerUnassigned
          summary: Task reassigned to another worker
          payload:
            workerId: "PICKER-001"
            taskId: "RT-a1b2c3d4"
            taskType: "picking"
            reason: "reassignment"
            unassignedAt: "2024-12-24T10:10:00Z"

  schemas:
    CloudEventHeaders:
      $ref: '../../../shared/docs/asyncapi-cloudevents-schema.yaml#/CloudEventHeaders'
    WorkerRegisteredPayload:
      type: object
      properties:
        workerId:
          type: string
          example: "PICKER-001"
        name:
          type: string
          example: "John Doe"
        skills:
          type: array
          items:
            type: string
          example: ["picking", "packing"]
        certifications:
          type: array
          items:
            type: string
          example: ["forklift"]
        registeredAt:
          type: string
          format: date-time

    ShiftStartedPayload:
      type: object
      properties:
        shiftId:
          type: string
          example: "SHIFT-001234"
        workerId:
          type: string
          example: "PICKER-001"
        zone:
          type: string
          example: "zone-a"
        shiftType:
          type: string
          enum: [morning, afternoon, evening, night]
          example: "morning"
        stationId:
          type: string
          example: "STATION-A1"
        startedAt:
          type: string
          format: date-time

    ShiftEndedPayload:
      type: object
      properties:
        shiftId:
          type: string
          example: "SHIFT-001234"
        workerId:
          type: string
          example: "PICKER-001"
        zone:
          type: string
          example: "zone-a"
        startedAt:
          type: string
          format: date-time
        endedAt:
          type: string
          format: date-time
        duration:
          type: string
          description: ISO 8601 duration
          example: "PT8H"
        tasksCompleted:
          type: integer
          example: 45
        itemsProcessed:
          type: integer
          example: 523
        productivity:
          type: number
          description: Productivity score 0-100
          example: 92.5

    BreakStartedPayload:
      type: object
      properties:
        workerId:
          type: string
          example: "PICKER-001"
        shiftId:
          type: string
          example: "SHIFT-001234"
        breakType:
          type: string
          enum: [short, lunch, other]
          example: "lunch"
        expectedDuration:
          type: integer
          description: Expected duration in minutes
          example: 30
        startedAt:
          type: string
          format: date-time

    BreakEndedPayload:
      type: object
      properties:
        workerId:
          type: string
          example: "PICKER-001"
        shiftId:
          type: string
          example: "SHIFT-001234"
        breakType:
          type: string
          example: "lunch"
        actualDuration:
          type: integer
          description: Actual duration in minutes
          example: 32
        endedAt:
          type: string
          format: date-time

    WorkerAssignedPayload:
      type: object
      properties:
        workerId:
          type: string
          example: "PICKER-001"
        taskId:
          type: string
          example: "RT-a1b2c3d4"
        taskType:
          type: string
          enum: [picking, packing, consolidation, receiving, stowing, shipping]
          example: "picking"
        priority:
          type: integer
          example: 1
        assignedAt:
          type: string
          format: date-time

    TaskCompletedPayload:
      type: object
      properties:
        taskId:
          type: string
          example: "RT-a1b2c3d4"
        workerId:
          type: string
          example: "PICKER-001"
        taskType:
          type: string
          example: "picking"
        completedAt:
          type: string
          format: date-time
        duration:
          type: integer
          description: Task duration in seconds
          example: 1500
        itemsProcessed:
          type: integer
          example: 15

    WorkerUnassignedPayload:
      type: object
      properties:
        workerId:
          type: string
          example: "PICKER-001"
        taskId:
          type: string
          example: "RT-a1b2c3d4"
        taskType:
          type: string
          example: "picking"
        reason:
          type: string
          enum: [reassignment, cancellation, priority_change, worker_unavailable, other]
          example: "reassignment"
        unassignedAt:
          type: string
          format: date-time
