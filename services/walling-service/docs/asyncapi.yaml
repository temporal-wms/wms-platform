asyncapi: 3.0.0
info:
  title: WMS Walling Service Events
  version: 1.0.0
  description: |
    AsyncAPI specification for Walling Service domain events.

    The Walling service publishes events to track put-wall sorting operations.
    Events follow the CloudEvents 1.0 specification.

    **Event Flow:**
    1. TaskCreated - When a new walling task is created
    2. TaskAssigned - When a walliner is assigned to a task
    3. ItemSorted - When an item is sorted to a bin
    4. TaskCompleted - When all items are sorted
    5. TaskCancelled - When a task is cancelled
  contact:
    name: WMS Platform Team
    email: wms@example.com

servers:
  kafka:
    host: localhost:9092
    protocol: kafka
    description: Local Kafka broker

defaultContentType: application/json

channels:
  wms.walling.events:
    address: wms.walling.events
    description: Walling service events topic
    messages:
      taskCreated:
        $ref: '#/components/messages/WallingTaskCreatedEvent'
      taskAssigned:
        $ref: '#/components/messages/WallingTaskAssignedEvent'
      itemSorted:
        $ref: '#/components/messages/ItemSortedEvent'
      taskCompleted:
        $ref: '#/components/messages/WallingTaskCompletedEvent'
      taskCancelled:
        $ref: '#/components/messages/WallingTaskCancelledEvent'

operations:
  publishTaskCreated:
    action: send
    channel:
      $ref: '#/channels/wms.walling.events'
    summary: Publish task created event
    messages:
      - $ref: '#/channels/wms.walling.events/messages/taskCreated'

  publishTaskAssigned:
    action: send
    channel:
      $ref: '#/channels/wms.walling.events'
    summary: Publish task assigned event
    messages:
      - $ref: '#/channels/wms.walling.events/messages/taskAssigned'

  publishItemSorted:
    action: send
    channel:
      $ref: '#/channels/wms.walling.events'
    summary: Publish item sorted event
    messages:
      - $ref: '#/channels/wms.walling.events/messages/itemSorted'

  publishTaskCompleted:
    action: send
    channel:
      $ref: '#/channels/wms.walling.events'
    summary: Publish task completed event
    messages:
      - $ref: '#/channels/wms.walling.events/messages/taskCompleted'

  publishTaskCancelled:
    action: send
    channel:
      $ref: '#/channels/wms.walling.events'
    summary: Publish task cancelled event
    messages:
      - $ref: '#/channels/wms.walling.events/messages/taskCancelled'

components:
  messages:
    WallingTaskCreatedEvent:
      name: WallingTaskCreatedEvent
      title: Walling Task Created
      summary: Published when a new walling task is created
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/WallingTaskCreatedPayload'

    WallingTaskAssignedEvent:
      name: WallingTaskAssignedEvent
      title: Walling Task Assigned
      summary: Published when a walliner is assigned to a task
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/WallingTaskAssignedPayload'

    ItemSortedEvent:
      name: ItemSortedEvent
      title: Item Sorted
      summary: Published when an item is sorted to a bin
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/ItemSortedPayload'

    WallingTaskCompletedEvent:
      name: WallingTaskCompletedEvent
      title: Walling Task Completed
      summary: Published when all items are sorted
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/WallingTaskCompletedPayload'

    WallingTaskCancelledEvent:
      name: WallingTaskCancelledEvent
      title: Walling Task Cancelled
      summary: Published when a task is cancelled
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/WallingTaskCancelledPayload'

  schemas:
    CloudEventHeaders:
      $ref: '../../../shared/docs/asyncapi-cloudevents-schema.yaml#/CloudEventHeaders'
    WallingTaskCreatedPayload:
      type: object
      properties:
        taskId:
          type: string
          example: "WT-a1b2c3d4"
        orderId:
          type: string
          example: "ORD-12345678"
        waveId:
          type: string
          example: "WV-DIG-20241230-001"
        routeId:
          type: string
          example: "RT-xyz"
        putWallId:
          type: string
          example: "PUTWALL-1"
        destinationBin:
          type: string
          example: "BIN-A1"
        itemCount:
          type: integer
          example: 5
        sourceTotes:
          type: array
          items:
            type: string
          example: ["TOTE-001", "TOTE-002"]
        createdAt:
          type: string
          format: date-time

    WallingTaskAssignedPayload:
      type: object
      properties:
        taskId:
          type: string
          example: "WT-a1b2c3d4"
        orderId:
          type: string
          example: "ORD-12345678"
        wallinerId:
          type: string
          example: "WALLINER-001"
        station:
          type: string
          example: "STATION-1"
        assignedAt:
          type: string
          format: date-time

    ItemSortedPayload:
      type: object
      properties:
        taskId:
          type: string
          example: "WT-a1b2c3d4"
        orderId:
          type: string
          example: "ORD-12345678"
        sku:
          type: string
          example: "SKU-001"
        quantity:
          type: integer
          example: 1
        fromToteId:
          type: string
          example: "TOTE-001"
        toBinId:
          type: string
          example: "BIN-A1"
        sortedAt:
          type: string
          format: date-time

    WallingTaskCompletedPayload:
      type: object
      properties:
        taskId:
          type: string
          example: "WT-a1b2c3d4"
        orderId:
          type: string
          example: "ORD-12345678"
        routeId:
          type: string
          example: "RT-xyz"
        itemsSorted:
          type: integer
          example: 5
        duration:
          type: string
          description: ISO 8601 duration
          example: "PT8M15S"
        completedAt:
          type: string
          format: date-time

    WallingTaskCancelledPayload:
      type: object
      properties:
        taskId:
          type: string
          example: "WT-a1b2c3d4"
        orderId:
          type: string
          example: "ORD-12345678"
        reason:
          type: string
          example: "Order cancelled by customer"
        cancelledAt:
          type: string
          format: date-time
