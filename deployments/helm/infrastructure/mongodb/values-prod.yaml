# MongoDB Helm Chart Values for WMS Platform
# Chart: oci://registry-1.docker.io/bitnamicharts/mongodb
#
# Install:
#   helm install mongodb oci://registry-1.docker.io/bitnamicharts/mongodb \
#     -n wms-platform -f values-prod.yaml

# Architecture: Replica Set for transaction support
architecture: replicaset

# Replica count (1 for Kind/dev, 3 for production)
replicaCount: 1

# Authentication
auth:
  enabled: true
  rootUser: root
  rootPassword: rootpassword
  usernames:
    - wmsuser
  passwords:
    - wmspassword
  databases:
    - wms
  replicaSetKey: wmsreplicasetkey

# Persistence
persistence:
  enabled: true
  size: 10Gi
  storageClass: ""

# Resources
resources:
  requests:
    memory: 256Mi
    cpu: 100m
  limits:
    memory: 512Mi
    cpu: 500m

# Arbiter configuration
arbiter:
  enabled: true
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 256Mi
      cpu: 200m

# Metrics (Prometheus)
metrics:
  enabled: true
  resources:
    requests:
      memory: 64Mi
      cpu: 50m
    limits:
      memory: 128Mi
      cpu: 100m

# Pod disruption budget
pdb:
  create: true
  minAvailable: 1

# Service configuration
service:
  type: ClusterIP
  ports:
    mongodb: 27017

# Init containers to wait for DNS
initContainers: []

# Extra environment variables
extraEnvVars: []

# Init script to grant wmsuser permissions on all databases
# Note: wmsuser is created in 'wms' database by the auth config
initdbScripts:
  grant-permissions.js: |
    db = db.getSiblingDB('wms');
    db.grantRolesToUser('wmsuser', [
      { role: 'readWriteAnyDatabase', db: 'admin' }
    ]);

# Liveness and Readiness probes
livenessProbe:
  enabled: true
  initialDelaySeconds: 30
  periodSeconds: 20
  timeoutSeconds: 10
  failureThreshold: 6

readinessProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6

# Pod annotations for monitoring
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "9216"
