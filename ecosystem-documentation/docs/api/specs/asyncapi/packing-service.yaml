asyncapi: 3.0.0
info:
  title: WMS Packing Service Events
  version: 1.0.0
  description: |
    AsyncAPI specification for Packing Service domain events.

    The Packing service publishes events to track pack task execution progress.
    Events follow the CloudEvents 1.0 specification.

    **Event Flow:**
    1. PackTaskCreated - When a new pack task is created
    2. PackTaskAssigned - When a packer is assigned to a task
    3. ItemVerified - When each item is scanned and verified
    4. PackagingSuggested - When system suggests packaging
    5. PackageSelected - When package type is selected
    6. PackageSealed - When package is sealed
    7. LabelApplied - When shipping label is applied
    8. PackTaskCompleted - When packing is complete
    9. PackTaskCancelled - When a task is cancelled

    **Integration:**
    - WES listens for PackTaskCompleted to advance route stages
    - Shipping service listens for packaging events
  contact:
    name: WMS Platform Team
    email: wms@example.com

servers:
  kafka:
    host: localhost:9092
    protocol: kafka
    description: Local Kafka broker

defaultContentType: application/json

channels:
  wms.packing.events:
    address: wms.packing.events
    description: Packing task events topic (3 partitions, keyed by orderId)
    messages:
      packTaskCreated:
        $ref: '#/components/messages/PackTaskCreatedEvent'
      packTaskAssigned:
        $ref: '#/components/messages/PackTaskAssignedEvent'
      itemVerified:
        $ref: '#/components/messages/ItemVerifiedEvent'
      packagingSuggested:
        $ref: '#/components/messages/PackagingSuggestedEvent'
      packageSelected:
        $ref: '#/components/messages/PackageSelectedEvent'
      packageSealed:
        $ref: '#/components/messages/PackageSealedEvent'
      labelApplied:
        $ref: '#/components/messages/LabelAppliedEvent'
      packTaskCompleted:
        $ref: '#/components/messages/PackTaskCompletedEvent'
      packTaskCancelled:
        $ref: '#/components/messages/PackTaskCancelledEvent'

operations:
  publishPackTaskCreated:
    action: send
    channel:
      $ref: '#/channels/wms.packing.events'
    summary: Publish pack task created event
    description: Published when a new pack task is created for an order
    messages:
      - $ref: '#/channels/wms.packing.events/messages/packTaskCreated'

  publishPackTaskAssigned:
    action: send
    channel:
      $ref: '#/channels/wms.packing.events'
    summary: Publish pack task assigned event
    description: Published when a packer is assigned to a task
    messages:
      - $ref: '#/channels/wms.packing.events/messages/packTaskAssigned'

  publishItemVerified:
    action: send
    channel:
      $ref: '#/channels/wms.packing.events'
    summary: Publish item verified event
    description: Published when an item is scanned and verified
    messages:
      - $ref: '#/channels/wms.packing.events/messages/itemVerified'

  publishPackagingSuggested:
    action: send
    channel:
      $ref: '#/channels/wms.packing.events'
    summary: Publish packaging suggested event
    description: Published when system suggests optimal packaging
    messages:
      - $ref: '#/channels/wms.packing.events/messages/packagingSuggested'

  publishPackageSelected:
    action: send
    channel:
      $ref: '#/channels/wms.packing.events'
    summary: Publish package selected event
    description: Published when package type is selected
    messages:
      - $ref: '#/channels/wms.packing.events/messages/packageSelected'

  publishPackageSealed:
    action: send
    channel:
      $ref: '#/channels/wms.packing.events'
    summary: Publish package sealed event
    description: Published when package is sealed
    messages:
      - $ref: '#/channels/wms.packing.events/messages/packageSealed'

  publishLabelApplied:
    action: send
    channel:
      $ref: '#/channels/wms.packing.events'
    summary: Publish label applied event
    description: Published when shipping label is applied
    messages:
      - $ref: '#/channels/wms.packing.events/messages/labelApplied'

  publishPackTaskCompleted:
    action: send
    channel:
      $ref: '#/channels/wms.packing.events'
    summary: Publish pack task completed event
    description: Published when packing task is complete
    messages:
      - $ref: '#/channels/wms.packing.events/messages/packTaskCompleted'

  publishPackTaskCancelled:
    action: send
    channel:
      $ref: '#/channels/wms.packing.events'
    summary: Publish pack task cancelled event
    description: Published when a pack task is cancelled
    messages:
      - $ref: '#/channels/wms.packing.events/messages/packTaskCancelled'

components:
  messages:
    PackTaskCreatedEvent:
      name: PackTaskCreatedEvent
      title: Pack Task Created
      summary: Published when a new pack task is created
      description: |
        Triggered when WES creates a pack task during route execution.
        Contains the list of items to be packed.
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/PackTaskCreatedPayload'
      examples:
        - name: taskCreated
          summary: Pack task created
          payload:
            taskId: "PK-a1b2c3d4"
            orderId: "ORD-12345678"
            routeId: "RT-xyz123"
            sourceType: "tote"
            sourceToteId: "TOTE-001"
            items:
              - sku: "WIDGET-001"
                quantity: 2
            totalItems: 1
            totalQuantity: 2
            createdAt: "2024-12-24T10:00:00Z"

    PackTaskAssignedEvent:
      name: PackTaskAssignedEvent
      title: Pack Task Assigned
      summary: Published when a packer is assigned to a task
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/PackTaskAssignedPayload'
      examples:
        - name: assigned
          summary: Packer assigned to task
          payload:
            taskId: "PK-a1b2c3d4"
            orderId: "ORD-12345678"
            packerId: "PACKER-001"
            stationId: "PACK-STATION-5"
            assignedAt: "2024-12-24T10:05:00Z"

    ItemVerifiedEvent:
      name: ItemVerifiedEvent
      title: Item Verified
      summary: Published when an item is scanned and verified
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/ItemVerifiedPayload'
      examples:
        - name: itemVerified
          summary: Item verified
          payload:
            taskId: "PK-a1b2c3d4"
            orderId: "ORD-12345678"
            sku: "WIDGET-001"
            quantity: 1
            verifiedAt: "2024-12-24T10:08:00Z"

    PackagingSuggestedEvent:
      name: PackagingSuggestedEvent
      title: Packaging Suggested
      summary: Published when system suggests optimal packaging
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/PackagingSuggestedPayload'
      examples:
        - name: suggested
          summary: Packaging suggestion
          payload:
            taskId: "PK-a1b2c3d4"
            orderId: "ORD-12345678"
            suggestedPackageType: "medium_box"
            dimensions:
              length: 14
              width: 10
              height: 6
            suggestedAt: "2024-12-24T10:10:00Z"

    PackageSelectedEvent:
      name: PackageSelectedEvent
      title: Package Selected
      summary: Published when package type is selected
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/PackageSelectedPayload'
      examples:
        - name: selected
          summary: Package selected
          payload:
            taskId: "PK-a1b2c3d4"
            orderId: "ORD-12345678"
            packageType: "medium_box"
            packageId: "PKG-001"
            dimensions:
              length: 14
              width: 10
              height: 6
            selectedAt: "2024-12-24T10:12:00Z"

    PackageSealedEvent:
      name: PackageSealedEvent
      title: Package Sealed
      summary: Published when package is sealed
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/PackageSealedPayload'
      examples:
        - name: sealed
          summary: Package sealed
          payload:
            taskId: "PK-a1b2c3d4"
            orderId: "ORD-12345678"
            packageId: "PKG-001"
            packageType: "medium_box"
            weight: 3.5
            sealedAt: "2024-12-24T10:15:00Z"

    LabelAppliedEvent:
      name: LabelAppliedEvent
      title: Label Applied
      summary: Published when shipping label is applied
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/LabelAppliedPayload'
      examples:
        - name: labelApplied
          summary: Shipping label applied
          payload:
            taskId: "PK-a1b2c3d4"
            orderId: "ORD-12345678"
            packageId: "PKG-001"
            trackingNumber: "1Z999AA10123456784"
            carrier: "UPS"
            appliedAt: "2024-12-24T10:16:00Z"

    PackTaskCompletedEvent:
      name: PackTaskCompletedEvent
      title: Pack Task Completed
      summary: Published when packing task is complete
      description: |
        Triggered when pack task is fully completed.
        WES listens for this event to advance to shipping.
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/PackTaskCompletedPayload'
      examples:
        - name: completed
          summary: Pack task completed
          payload:
            taskId: "PK-a1b2c3d4"
            orderId: "ORD-12345678"
            routeId: "RT-xyz123"
            packerId: "PACKER-001"
            packageId: "PKG-001"
            trackingNumber: "1Z999AA10123456784"
            carrier: "UPS"
            weight: 3.5
            duration: "PT8M45S"
            completedAt: "2024-12-24T10:18:45Z"

    PackTaskCancelledEvent:
      name: PackTaskCancelledEvent
      title: Pack Task Cancelled
      summary: Published when a pack task is cancelled
      contentType: application/json
      headers:
        $ref: '#/components/schemas/CloudEventHeaders'
      payload:
        $ref: '#/components/schemas/PackTaskCancelledPayload'
      examples:
        - name: cancelled
          summary: Pack task cancelled
          payload:
            taskId: "PK-a1b2c3d4"
            orderId: "ORD-12345678"
            reason: "Order cancelled by customer"
            cancelledAt: "2024-12-24T10:12:00Z"

  schemas:
    CloudEventHeaders:
      type: object
      description: CloudEvents 1.0 headers with WMS extensions
      properties:
        ce_specversion:
          type: string
          const: '1.0'
        ce_type:
          type: string
          description: Event type
        ce_source:
          type: string
          const: '/wms/packing-service'
        ce_subject:
          type: string
          description: Task ID
        ce_id:
          type: string
          format: uuid
        ce_time:
          type: string
          format: date-time
        ce_datacontenttype:
          type: string
          const: 'application/json'
        ce_wmscorrelationid:
          type: string
        ce_wmsworkflowid:
          type: string

    PackTaskCreatedPayload:
      type: object
      properties:
        taskId:
          type: string
          example: "PK-a1b2c3d4"
        orderId:
          type: string
          example: "ORD-12345678"
        routeId:
          type: string
          example: "RT-xyz123"
        sourceType:
          type: string
          enum: [tote, putwall_bin, consolidation]
        sourceToteId:
          type: string
        sourceBinId:
          type: string
        items:
          type: array
          items:
            type: object
            properties:
              sku:
                type: string
              quantity:
                type: integer
        totalItems:
          type: integer
        totalQuantity:
          type: integer
        createdAt:
          type: string
          format: date-time

    PackTaskAssignedPayload:
      type: object
      properties:
        taskId:
          type: string
        orderId:
          type: string
        packerId:
          type: string
        stationId:
          type: string
        assignedAt:
          type: string
          format: date-time

    ItemVerifiedPayload:
      type: object
      properties:
        taskId:
          type: string
        orderId:
          type: string
        sku:
          type: string
        quantity:
          type: integer
        verifiedAt:
          type: string
          format: date-time

    PackagingSuggestedPayload:
      type: object
      properties:
        taskId:
          type: string
        orderId:
          type: string
        suggestedPackageType:
          type: string
          enum: [small_box, medium_box, large_box, envelope, padded_envelope, custom]
        dimensions:
          type: object
          properties:
            length:
              type: number
            width:
              type: number
            height:
              type: number
        suggestedAt:
          type: string
          format: date-time

    PackageSelectedPayload:
      type: object
      properties:
        taskId:
          type: string
        orderId:
          type: string
        packageType:
          type: string
        packageId:
          type: string
        dimensions:
          type: object
          properties:
            length:
              type: number
            width:
              type: number
            height:
              type: number
        selectedAt:
          type: string
          format: date-time

    PackageSealedPayload:
      type: object
      properties:
        taskId:
          type: string
        orderId:
          type: string
        packageId:
          type: string
        packageType:
          type: string
        weight:
          type: number
        sealedAt:
          type: string
          format: date-time

    LabelAppliedPayload:
      type: object
      properties:
        taskId:
          type: string
        orderId:
          type: string
        packageId:
          type: string
        trackingNumber:
          type: string
        carrier:
          type: string
        appliedAt:
          type: string
          format: date-time

    PackTaskCompletedPayload:
      type: object
      properties:
        taskId:
          type: string
        orderId:
          type: string
        routeId:
          type: string
        packerId:
          type: string
        packageId:
          type: string
        trackingNumber:
          type: string
        carrier:
          type: string
        weight:
          type: number
        duration:
          type: string
          description: ISO 8601 duration
          example: "PT8M45S"
        completedAt:
          type: string
          format: date-time

    PackTaskCancelledPayload:
      type: object
      properties:
        taskId:
          type: string
        orderId:
          type: string
        reason:
          type: string
        cancelledAt:
          type: string
          format: date-time
