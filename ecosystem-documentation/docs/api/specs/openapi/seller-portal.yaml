openapi: 3.0.3
info:
  title: WMS Seller Portal API
  description: |
    REST API for the seller-facing dashboard in the WMS Platform.

    This service provides a unified API for sellers to:
    - View dashboard metrics and KPIs
    - Manage orders and fulfillment
    - Monitor inventory levels
    - Review billing and invoices
    - Configure channel integrations
    - Generate and manage API keys

    **Authentication:**
    - API Key authentication via `X-API-Key` header
    - JWT authentication for web dashboard

    **Multi-Tenant Context:**
    - All endpoints are scoped to the authenticated seller
    - Tenant and seller context derived from authentication

    **Aggregated Data:**
    This service aggregates data from multiple backend services:
    - seller-service: Account and configuration
    - order-service: Order data
    - inventory-service: Stock levels
    - billing-service: Invoices and fees
    - channel-service: Channel integrations
  version: 1.0.0
  contact:
    name: WMS Platform Team
    email: wms@example.com

servers:
  - url: http://localhost:8013/api/v1
    description: Development server
  - url: https://portal.wms.example.com/api/v1
    description: Production server

tags:
  - name: Dashboard
    description: Dashboard and analytics
  - name: Orders
    description: Order management
  - name: Inventory
    description: Inventory monitoring
  - name: Billing
    description: Invoices and billing
  - name: Integrations
    description: Channel integrations
  - name: Settings
    description: Account settings
  - name: API Keys
    description: API key management
  - name: Health
    description: Service health and readiness

security:
  - ApiKeyAuth: []
  - BearerAuth: []

paths:
  /dashboard/summary:
    get:
      summary: Get dashboard summary
      description: |
        Returns key metrics for the seller dashboard.

        **Metrics Included:**
        - Orders: pending, processing, shipped, delivered today
        - Inventory: total SKUs, low stock alerts
        - Billing: current period charges, outstanding balance
        - Performance: fulfillment rate, on-time shipping rate
      tags: [Dashboard]
      parameters:
        - name: period
          in: query
          description: Time period for metrics
          schema:
            type: string
            enum: [today, week, month, quarter]
            default: today
      responses:
        '200':
          description: Dashboard summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardSummary'
              examples:
                summary:
                  value:
                    orders:
                      pending: 15
                      processing: 8
                      shipped: 45
                      delivered: 120
                      total: 188
                    inventory:
                      totalSkus: 150
                      lowStockAlerts: 5
                      outOfStock: 2
                    billing:
                      currentPeriodCharges: 1250.00
                      outstandingBalance: 500.00
                      dueDate: "2024-12-31"
                    performance:
                      fulfillmentRate: 98.5
                      onTimeShippingRate: 96.2
                      avgFulfillmentHours: 4.5
                    period: "today"
                    generatedAt: "2024-12-24T10:00:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'

  /dashboard/orders-chart:
    get:
      summary: Get orders chart data
      description: Returns time-series data for order volume charts.
      tags: [Dashboard]
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum: [7d, 30d, 90d]
            default: 30d
        - name: groupBy
          in: query
          schema:
            type: string
            enum: [day, week]
            default: day
      responses:
        '200':
          description: Orders chart data
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        date:
                          type: string
                          format: date
                        orders:
                          type: integer
                        revenue:
                          type: number

  /dashboard/alerts:
    get:
      summary: Get alerts
      description: Returns active alerts requiring attention.
      tags: [Dashboard]
      responses:
        '200':
          description: Active alerts
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Alert'

  /orders:
    get:
      summary: List orders
      description: Retrieve seller's orders with filtering and pagination.
      tags: [Orders]
      parameters:
        - name: status
          in: query
          description: Filter by order status
          schema:
            type: string
            enum: [pending, processing, shipped, delivered, cancelled]
        - name: channel
          in: query
          description: Filter by sales channel
          schema:
            type: string
        - name: search
          in: query
          description: Search by order ID or customer name
          schema:
            type: string
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: List of orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/OrderSummary'
                  total:
                    type: integer
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /orders/{orderId}:
    get:
      summary: Get order details
      description: Retrieve detailed order information including timeline.
      tags: [Orders]
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDetail'
        '404':
          description: Order not found

  /orders/{orderId}/cancel:
    post:
      summary: Request order cancellation
      description: |
        Requests cancellation of an order.

        **Note:** Cancellation may not be possible if order is already in fulfillment.
      tags: [Orders]
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
                  example: "Customer requested cancellation"
      responses:
        '200':
          description: Cancellation requested
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDetail'
        '400':
          description: Order cannot be cancelled

  /inventory:
    get:
      summary: List inventory
      description: Retrieve seller's inventory with filtering.
      tags: [Inventory]
      parameters:
        - name: search
          in: query
          description: Search by SKU or product name
          schema:
            type: string
        - name: lowStock
          in: query
          description: Filter for low stock items
          schema:
            type: boolean
        - name: outOfStock
          in: query
          description: Filter for out of stock items
          schema:
            type: boolean
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: List of inventory items
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/InventoryItem'
                  total:
                    type: integer
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /inventory/{sku}:
    get:
      summary: Get inventory item
      description: Retrieve detailed inventory for a SKU.
      tags: [Inventory]
      parameters:
        - name: sku
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Inventory item details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InventoryItemDetail'
        '404':
          description: SKU not found

  /inventory/alerts:
    get:
      summary: Get inventory alerts
      description: Get low stock and out of stock alerts.
      tags: [Inventory]
      responses:
        '200':
          description: Inventory alerts
          content:
            application/json:
              schema:
                type: object
                properties:
                  lowStock:
                    type: array
                    items:
                      $ref: '#/components/schemas/InventoryAlert'
                  outOfStock:
                    type: array
                    items:
                      $ref: '#/components/schemas/InventoryAlert'

  /billing/invoices:
    get:
      summary: List invoices
      description: Retrieve seller's invoices.
      tags: [Billing]
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [draft, finalized, paid, overdue, voided]
        - name: startDate
          in: query
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          schema:
            type: string
            format: date
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: List of invoices
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/InvoiceSummary'
                  total:
                    type: integer

  /billing/invoices/{invoiceId}:
    get:
      summary: Get invoice details
      description: Retrieve detailed invoice with line items.
      tags: [Billing]
      parameters:
        - name: invoiceId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Invoice details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InvoiceDetail'
        '404':
          description: Invoice not found

  /billing/invoices/{invoiceId}/download:
    get:
      summary: Download invoice PDF
      description: Download invoice as PDF.
      tags: [Billing]
      parameters:
        - name: invoiceId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: PDF file
          content:
            application/pdf:
              schema:
                type: string
                format: binary

  /billing/current-period:
    get:
      summary: Get current period charges
      description: Get breakdown of current billing period charges.
      tags: [Billing]
      responses:
        '200':
          description: Current period charges
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CurrentPeriodCharges'

  /integrations:
    get:
      summary: List channel integrations
      description: Get all connected sales channels.
      tags: [Integrations]
      responses:
        '200':
          description: List of integrations
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/IntegrationSummary'

    post:
      summary: Connect channel
      description: Connect a new sales channel.
      tags: [Integrations]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConnectChannelRequest'
      responses:
        '201':
          description: Channel connected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IntegrationSummary'
        '400':
          description: Invalid credentials

  /integrations/{channelId}:
    get:
      summary: Get integration details
      description: Get details of a channel integration.
      tags: [Integrations]
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Integration details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IntegrationDetail'

    delete:
      summary: Disconnect channel
      description: Disconnect a sales channel.
      tags: [Integrations]
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Channel disconnected

  /integrations/{channelId}/sync:
    post:
      summary: Trigger sync
      description: Manually trigger a sync with the channel.
      tags: [Integrations]
      parameters:
        - name: channelId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - type
              properties:
                type:
                  type: string
                  enum: [orders, inventory, tracking]
      responses:
        '202':
          description: Sync started
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobId:
                    type: string
                  status:
                    type: string

  /settings/profile:
    get:
      summary: Get seller profile
      description: Get seller account information.
      tags: [Settings]
      responses:
        '200':
          description: Seller profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SellerProfile'

    put:
      summary: Update seller profile
      description: Update seller contact information.
      tags: [Settings]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProfileRequest'
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SellerProfile'

  /settings/facilities:
    get:
      summary: List assigned facilities
      description: Get facilities where seller has inventory.
      tags: [Settings]
      responses:
        '200':
          description: List of facilities
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FacilitySummary'

  /settings/fee-schedule:
    get:
      summary: Get fee schedule
      description: Get current fee schedule.
      tags: [Settings]
      responses:
        '200':
          description: Fee schedule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeeSchedule'

  /api-keys:
    get:
      summary: List API keys
      description: Get all API keys for the seller.
      tags: [API Keys]
      responses:
        '200':
          description: List of API keys
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ApiKeyInfo'

    post:
      summary: Generate API key
      description: |
        Generate a new API key.

        **Important:** The key value is only shown once. Store it securely.
      tags: [API Keys]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateApiKeyRequest'
      responses:
        '201':
          description: API key generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiKeyResponse'

  /api-keys/{keyId}:
    delete:
      summary: Revoke API key
      description: Revoke an API key.
      tags: [API Keys]
      parameters:
        - name: keyId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: API key revoked

  /health:
    get:
      summary: Health check
      tags: [Health]
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /ready:
    get:
      summary: Readiness check
      tags: [Health]
      security: []
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    DashboardSummary:
      type: object
      properties:
        orders:
          type: object
          properties:
            pending:
              type: integer
            processing:
              type: integer
            shipped:
              type: integer
            delivered:
              type: integer
            total:
              type: integer
        inventory:
          type: object
          properties:
            totalSkus:
              type: integer
            lowStockAlerts:
              type: integer
            outOfStock:
              type: integer
        billing:
          type: object
          properties:
            currentPeriodCharges:
              type: number
            outstandingBalance:
              type: number
            dueDate:
              type: string
              format: date
        performance:
          type: object
          properties:
            fulfillmentRate:
              type: number
            onTimeShippingRate:
              type: number
            avgFulfillmentHours:
              type: number
        period:
          type: string
        generatedAt:
          type: string
          format: date-time

    Alert:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum: [low_stock, out_of_stock, order_issue, payment_due, channel_error]
        severity:
          type: string
          enum: [info, warning, critical]
        title:
          type: string
        message:
          type: string
        link:
          type: string
        createdAt:
          type: string
          format: date-time

    OrderSummary:
      type: object
      properties:
        orderId:
          type: string
        externalOrderId:
          type: string
        channel:
          type: string
        status:
          type: string
        customerName:
          type: string
        itemCount:
          type: integer
        total:
          type: number
        createdAt:
          type: string
          format: date-time

    OrderDetail:
      type: object
      properties:
        orderId:
          type: string
        externalOrderId:
          type: string
        channel:
          type: string
        status:
          type: string
        customer:
          type: object
          properties:
            name:
              type: string
            email:
              type: string
            phone:
              type: string
        shippingAddress:
          type: object
        lineItems:
          type: array
          items:
            type: object
            properties:
              sku:
                type: string
              title:
                type: string
              quantity:
                type: integer
              price:
                type: number
        subtotal:
          type: number
        shipping:
          type: number
        tax:
          type: number
        total:
          type: number
        timeline:
          type: array
          items:
            type: object
            properties:
              status:
                type: string
              timestamp:
                type: string
                format: date-time
              description:
                type: string
        tracking:
          type: object
          properties:
            carrier:
              type: string
            trackingNumber:
              type: string
            trackingUrl:
              type: string
        createdAt:
          type: string
          format: date-time

    InventoryItem:
      type: object
      properties:
        sku:
          type: string
        productName:
          type: string
        available:
          type: integer
        reserved:
          type: integer
        total:
          type: integer
        reorderPoint:
          type: integer
        isLowStock:
          type: boolean
        isOutOfStock:
          type: boolean

    InventoryItemDetail:
      allOf:
        - $ref: '#/components/schemas/InventoryItem'
        - type: object
          properties:
            locations:
              type: array
              items:
                type: object
                properties:
                  locationId:
                    type: string
                  facility:
                    type: string
                  quantity:
                    type: integer
            recentActivity:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                  quantity:
                    type: integer
                  timestamp:
                    type: string
                    format: date-time

    InventoryAlert:
      type: object
      properties:
        sku:
          type: string
        productName:
          type: string
        available:
          type: integer
        reorderPoint:
          type: integer
        deficit:
          type: integer

    InvoiceSummary:
      type: object
      properties:
        invoiceId:
          type: string
        invoiceNumber:
          type: string
        status:
          type: string
        periodStart:
          type: string
          format: date
        periodEnd:
          type: string
          format: date
        total:
          type: number
        dueDate:
          type: string
          format: date
        paidAt:
          type: string
          format: date-time

    InvoiceDetail:
      allOf:
        - $ref: '#/components/schemas/InvoiceSummary'
        - type: object
          properties:
            lineItems:
              type: array
              items:
                type: object
                properties:
                  activityType:
                    type: string
                  description:
                    type: string
                  quantity:
                    type: number
                  unitPrice:
                    type: number
                  amount:
                    type: number
            subtotal:
              type: number
            taxRate:
              type: number
            taxAmount:
              type: number
            discount:
              type: number

    CurrentPeriodCharges:
      type: object
      properties:
        periodStart:
          type: string
          format: date
        periodEnd:
          type: string
          format: date
        byType:
          type: object
          additionalProperties:
            type: object
            properties:
              count:
                type: integer
              amount:
                type: number
        total:
          type: number

    IntegrationSummary:
      type: object
      properties:
        channelId:
          type: string
        type:
          type: string
        name:
          type: string
        status:
          type: string
        lastSync:
          type: string
          format: date-time
        hasError:
          type: boolean

    IntegrationDetail:
      allOf:
        - $ref: '#/components/schemas/IntegrationSummary'
        - type: object
          properties:
            storeUrl:
              type: string
            syncSettings:
              type: object
            recentSyncs:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                  status:
                    type: string
                  itemsProcessed:
                    type: integer
                  timestamp:
                    type: string
                    format: date-time

    ConnectChannelRequest:
      type: object
      required:
        - type
        - name
        - credentials
      properties:
        type:
          type: string
          enum: [shopify, amazon, ebay, woocommerce]
        name:
          type: string
        storeUrl:
          type: string
        credentials:
          type: object
          additionalProperties:
            type: string
        syncSettings:
          type: object

    SellerProfile:
      type: object
      properties:
        sellerId:
          type: string
        companyName:
          type: string
        contactName:
          type: string
        contactEmail:
          type: string
        contactPhone:
          type: string
        status:
          type: string
        billingCycle:
          type: string
        contractStartDate:
          type: string
          format: date

    UpdateProfileRequest:
      type: object
      properties:
        contactName:
          type: string
        contactEmail:
          type: string
        contactPhone:
          type: string

    FacilitySummary:
      type: object
      properties:
        facilityId:
          type: string
        facilityName:
          type: string
        warehouses:
          type: array
          items:
            type: string
        allocatedSpace:
          type: number
        isDefault:
          type: boolean

    FeeSchedule:
      type: object
      properties:
        storageFeePerCubicFtPerDay:
          type: number
        pickFeePerUnit:
          type: number
        packFeePerOrder:
          type: number
        receivingFeePerUnit:
          type: number
        shippingMarkupPercent:
          type: number
        returnProcessingFee:
          type: number
        giftWrapFee:
          type: number
        hazmatHandlingFee:
          type: number
        oversizedItemFee:
          type: number
        coldChainFeePerUnit:
          type: number
        effectiveFrom:
          type: string
          format: date

    ApiKeyInfo:
      type: object
      properties:
        keyId:
          type: string
        name:
          type: string
        prefix:
          type: string
        scopes:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        lastUsedAt:
          type: string
          format: date-time
        expiresAt:
          type: string
          format: date-time

    GenerateApiKeyRequest:
      type: object
      required:
        - name
        - scopes
      properties:
        name:
          type: string
        scopes:
          type: array
          items:
            type: string
        expiresAt:
          type: string
          format: date-time

    ApiKeyResponse:
      allOf:
        - $ref: '#/components/schemas/ApiKeyInfo'
        - type: object
          properties:
            rawKey:
              type: string
              description: Only shown once

    Pagination:
      type: object
      properties:
        page:
          type: integer
        pageSize:
          type: integer
        total:
          type: integer
        hasMore:
          type: boolean

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: "healthy"

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
        code:
          type: string
        details:
          type: object
