openapi: 3.0.3
info:
  title: Order Service API
  description: |
    Comprehensive REST API for order management operations in the WMS platform.

    ## Overview
    The Order Service is the entry point for all customer orders into the WMS fulfillment pipeline.
    It manages the complete order lifecycle from creation through completion or cancellation.

    ## Order Lifecycle
    Orders progress through the following states:
    1. **received** - Order created and awaiting validation
    2. **validated** - Order validated, inventory reserved
    3. **assigned_to_wave** - Order assigned to a fulfillment wave
    4. **picking** - Items being picked from inventory
    5. **packing** - Items being packed for shipment
    6. **shipped** - Order shipped to carrier
    7. **completed** - Order delivered successfully
    8. **cancelled** - Order cancelled (can occur at various stages)

    ## Priority Levels
    - **same_day**: Orders must ship same day, typically by 6 PM local time
    - **next_day**: Orders must ship within 24 hours
    - **standard**: Standard 3-5 day fulfillment window

    ## Special Handling
    Orders may require special handling based on item characteristics:
    - **High Value** ($500+): Requires dual verification, secure handling
    - **Fragile**: Special packing materials, careful handling required
    - **Hazmat**: OSHA/DOT compliance, certified handlers only
    - **Cold Chain**: Temperature-controlled packaging and shipping
    - **Oversized** (30kg+): Equipment required, special carrier selection

    ## Error Handling & Retry
    Failed orders enter a retry queue with exponential backoff.
    After max retries (default: 5), orders move to the Dead Letter Queue (DLQ)
    for manual resolution.

    ## Integration Points
    - **Process Path Service**: Determines fulfillment requirements
    - **Waving Service**: Wave assignment and release
    - **Inventory Service**: Stock reservation and allocation
    - **Shipping Service**: Carrier selection and label generation
  version: 1.0.0
  contact:
    name: WMS Platform Team
    email: wms@example.com

servers:
  - url: http://localhost:8001/api/v1
    description: Development server
  - url: https://api.wms.example.com/api/v1
    description: Production server

tags:
  - name: Orders
    description: Order management operations
  - name: Reprocessing
    description: Order reprocessing and retry operations
  - name: Dead Letter Queue
    description: Dead letter queue management for failed orders
  - name: Health
    description: Service health and readiness

paths:
  /orders:
    post:
      summary: Create a new order
      parameters:
        - $ref: '#/components/parameters/WMSCorrelationID'
        - $ref: '#/components/parameters/WMSWaveNumber'
        - $ref: '#/components/parameters/WMSWorkflowID'
      description: |
        Creates a new order in the system and triggers the order fulfillment workflow.

        ## Process Flow
        1. Order is validated for required fields and business rules
        2. Inventory availability is checked for all items
        3. Process path is determined based on item characteristics
        4. Order is queued for wave assignment based on priority
        5. Temporal workflow is initiated for fulfillment tracking

        ## Item Characteristics
        Include item attributes to enable proper process path determination:
        - `isFragile`: Triggers fragile_packing special handling
        - `isHazmat`: Triggers hazmat_compliance, requires hazmatDetails
        - `requiresColdChain`: Triggers cold_chain_packaging
        - `weight`: Orders with items totaling 30kg+ trigger oversized_handling

        ## Business Rules
        - Total value $500+ triggers high_value_verification
        - Same-day orders must be placed before 2 PM local time
        - Hazmat items cannot be combined with cold chain items
        - Gift wrap adds processing time (factor into SLA)
      tags:
        - Orders
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
            examples:
              simpleOrder:
                summary: Simple single-item order
                description: Basic e-commerce order with single low-value item - fastest fulfillment path
                value:
                  customerId: "CUST-2026-00001"
                  priority: "standard"
                  promisedDeliveryAt: "2026-01-14T17:00:00Z"
                  shippingAddress:
                    street: "742 Evergreen Terrace"
                    city: "Springfield"
                    state: "IL"
                    zipCode: "62701"
                    country: "US"
                  items:
                    - sku: "ELEC-HDMI-CBL-6FT"
                      productName: "HDMI Cable 6ft Gold-Plated"
                      quantity: 1
                      unitPrice: 12.99
                      weight: 0.15
              multiItemOrder:
                summary: Multi-item order requiring consolidation
                description: Order with multiple SKUs that will require wall consolidation before packing
                value:
                  customerId: "CUST-2026-00042"
                  priority: "next_day"
                  promisedDeliveryAt: "2026-01-10T17:00:00Z"
                  shippingAddress:
                    street: "221B Baker Street"
                    street2: "Apt 2A"
                    city: "Boston"
                    state: "MA"
                    zipCode: "02101"
                    country: "US"
                  items:
                    - sku: "APPAREL-TSHIRT-BLK-M"
                      productName: "Classic Black T-Shirt Medium"
                      quantity: 2
                      unitPrice: 24.99
                      weight: 0.3
                    - sku: "APPAREL-JEANS-BLU-32"
                      productName: "Slim Fit Blue Jeans 32x32"
                      quantity: 1
                      unitPrice: 59.99
                      weight: 0.8
                    - sku: "APPAREL-BELT-LTH-M"
                      productName: "Leather Belt Medium"
                      quantity: 1
                      unitPrice: 34.99
                      weight: 0.25
              highValueOrder:
                summary: High-value electronics order
                description: Order totaling $500+ triggers high_value_verification with dual sign-off
                value:
                  customerId: "CUST-2026-00187"
                  priority: "same_day"
                  promisedDeliveryAt: "2026-01-09T20:00:00Z"
                  shippingAddress:
                    street: "1 Infinite Loop"
                    city: "Cupertino"
                    state: "CA"
                    zipCode: "95014"
                    country: "US"
                  items:
                    - sku: "ELEC-LAPTOP-PRO-16"
                      productName: "Professional Laptop 16-inch"
                      quantity: 1
                      unitPrice: 2499.99
                      weight: 2.1
                      isFragile: true
                    - sku: "ELEC-MOUSE-WRLS"
                      productName: "Wireless Ergonomic Mouse"
                      quantity: 1
                      unitPrice: 79.99
                      weight: 0.12
              giftOrder:
                summary: Gift order with wrapping
                description: Order with gift wrap enabled - routes through gift wrap station
                value:
                  customerId: "CUST-2026-00256"
                  priority: "next_day"
                  promisedDeliveryAt: "2026-01-11T17:00:00Z"
                  giftWrap: true
                  giftMessage: "Happy Birthday! Enjoy your new watch. - Love, Mom"
                  shippingAddress:
                    street: "350 Fifth Avenue"
                    street2: "Floor 34"
                    city: "New York"
                    state: "NY"
                    zipCode: "10118"
                    country: "US"
                  items:
                    - sku: "JEWEL-WATCH-CHRONO-SLV"
                      productName: "Chronograph Watch Silver"
                      quantity: 1
                      unitPrice: 349.99
                      weight: 0.15
                      isFragile: true
              hazmatOrder:
                summary: Hazmat automotive order
                description: Order containing hazardous materials - requires DOT compliance and certified handlers
                value:
                  customerId: "CUST-2026-00089"
                  priority: "standard"
                  promisedDeliveryAt: "2026-01-15T17:00:00Z"
                  shippingAddress:
                    street: "4567 Industrial Parkway"
                    city: "Detroit"
                    state: "MI"
                    zipCode: "48201"
                    country: "US"
                  items:
                    - sku: "AUTO-BATT-12V-AGM"
                      productName: "AGM Car Battery 12V 800CCA"
                      quantity: 1
                      unitPrice: 189.99
                      weight: 22.5
                      isHazmat: true
                      hazmatDetails:
                        class: "8"
                        unNumber: "UN2794"
                        packingGroup: "III"
                        properShippingName: "Batteries, wet, filled with acid"
                    - sku: "AUTO-OIL-5W30-5QT"
                      productName: "Synthetic Motor Oil 5W-30 5 Quart"
                      quantity: 2
                      unitPrice: 34.99
                      weight: 4.5
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
              examples:
                simpleOrderCreated:
                  summary: Simple order created
                  description: Single-item order with standard fulfillment path
                  value:
                    orderId: "ORD-2026-0109-00001"
                    customerId: "CUST-2026-00001"
                    status: "received"
                    priority: "standard"
                    promisedDeliveryAt: "2026-01-14T17:00:00Z"
                    shippingAddress:
                      street: "742 Evergreen Terrace"
                      city: "Springfield"
                      state: "IL"
                      zipCode: "62701"
                      country: "US"
                    items:
                      - sku: "ELEC-HDMI-CBL-6FT"
                        productName: "HDMI Cable 6ft Gold-Plated"
                        quantity: 1
                        unitPrice: 12.99
                        weight: 0.15
                    processPath:
                      pathId: "PP-simple-001"
                      requirements: ["single_item"]
                      consolidationRequired: false
                      specialHandling: []
                    totalItems: 1
                    totalQuantity: 1
                    totalWeight: 0.15
                    totalValue: 12.99
                    createdAt: "2026-01-09T10:15:00Z"
                    updatedAt: "2026-01-09T10:15:00Z"
                highValueOrderCreated:
                  summary: High-value order created
                  description: Order with high_value and fragile requirements triggering special handling
                  value:
                    orderId: "ORD-2026-0109-00187"
                    customerId: "CUST-2026-00187"
                    status: "received"
                    priority: "same_day"
                    promisedDeliveryAt: "2026-01-09T20:00:00Z"
                    shippingAddress:
                      street: "1 Infinite Loop"
                      city: "Cupertino"
                      state: "CA"
                      zipCode: "95014"
                      country: "US"
                    items:
                      - sku: "ELEC-LAPTOP-PRO-16"
                        productName: "Professional Laptop 16-inch"
                        quantity: 1
                        unitPrice: 2499.99
                        weight: 2.1
                        isFragile: true
                      - sku: "ELEC-MOUSE-WRLS"
                        productName: "Wireless Ergonomic Mouse"
                        quantity: 1
                        unitPrice: 79.99
                        weight: 0.12
                    processPath:
                      pathId: "PP-highval-fragile-187"
                      requirements: ["multi_item", "high_value", "fragile"]
                      consolidationRequired: true
                      specialHandling: ["high_value_verification", "fragile_packing"]
                    totalItems: 2
                    totalQuantity: 2
                    totalWeight: 2.22
                    totalValue: 2579.98
                    createdAt: "2026-01-09T08:30:00Z"
                    updatedAt: "2026-01-09T08:30:00Z"
        '400':
          description: Invalid request - validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingRequiredField:
                  summary: Missing required field
                  value:
                    error: "VALIDATION_ERROR"
                    message: "Missing required field: shippingAddress"
                    details:
                      field: "shippingAddress"
                      constraint: "required"
                invalidPriority:
                  summary: Invalid priority value
                  value:
                    error: "VALIDATION_ERROR"
                    message: "Invalid priority value: 'urgent'. Must be one of: same_day, next_day, standard"
                    details:
                      field: "priority"
                      constraint: "enum"
                      allowedValues: ["same_day", "next_day", "standard"]
                sameDayCutoffPassed:
                  summary: Same-day cutoff passed
                  value:
                    error: "BUSINESS_RULE_VIOLATION"
                    message: "Same-day orders must be placed before 2:00 PM local time. Current time: 3:45 PM"
                    details:
                      rule: "same_day_cutoff"
                      cutoffTime: "14:00"
                      currentTime: "15:45"
        '409':
          description: Conflict - inventory not available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                insufficientInventory:
                  summary: Insufficient inventory
                  value:
                    error: "INVENTORY_UNAVAILABLE"
                    message: "Insufficient inventory for SKU: ELEC-LAPTOP-PRO-16"
                    details:
                      sku: "ELEC-LAPTOP-PRO-16"
                      requested: 1
                      available: 0
                      expectedRestock: "2026-01-12T00:00:00Z"
        '500':
          description: Internal server error

    get:
      summary: List orders
      description: |
        Retrieve a paginated list of orders with optional filtering.

        ## Common Use Cases
        - **Operations Dashboard**: Filter by status to monitor fulfillment pipeline
        - **Customer Service**: Filter by customerId to view customer order history
        - **Wave Planning**: Filter by priority to identify orders needing urgent processing
        - **Performance Tracking**: Analyze order volumes and status distribution
      tags:
        - Orders
      parameters:
        - name: page
          in: query
          description: Page number (1-indexed)
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: pageSize
          in: query
          description: Number of orders per page (max 100)
          schema:
            type: integer
            default: 20
            maximum: 100
        - name: status
          in: query
          description: Filter by order status
          schema:
            type: string
            enum: [received, validated, assigned_to_wave, picking, packing, shipped, completed, cancelled]
        - name: priority
          in: query
          description: Filter by order priority
          schema:
            type: string
            enum: [same_day, next_day, standard]
        - name: customerId
          in: query
          description: Filter by customer ID
          schema:
            type: string
        - name: waveId
          in: query
          description: Filter by wave assignment
          schema:
            type: string
        - name: createdAfter
          in: query
          description: Filter orders created after this timestamp (ISO 8601)
          schema:
            type: string
            format: date-time
        - name: createdBefore
          in: query
          description: Filter orders created before this timestamp (ISO 8601)
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: List of orders retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/OrderListItem'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                      pageSize:
                        type: integer
                      total:
                        type: integer
                      hasMore:
                        type: boolean
              examples:
                sameDayOrdersList:
                  summary: Same-day orders in picking
                  description: Filtered list of same-day priority orders currently in picking status
                  value:
                    data:
                      - orderId: "ORD-2026-0109-00187"
                        customerId: "CUST-2026-00187"
                        status: "picking"
                        priority: "same_day"
                        totalItems: 2
                        totalQuantity: 2
                        totalValue: 2579.98
                        waveId: "WAVE-2026-0109-AM-001"
                        createdAt: "2026-01-09T08:30:00Z"
                      - orderId: "ORD-2026-0109-00201"
                        customerId: "CUST-2026-00098"
                        status: "picking"
                        priority: "same_day"
                        totalItems: 1
                        totalQuantity: 3
                        totalValue: 149.97
                        waveId: "WAVE-2026-0109-AM-001"
                        createdAt: "2026-01-09T09:15:00Z"
                    pagination:
                      page: 1
                      pageSize: 20
                      total: 2
                      hasMore: false
                customerOrderHistory:
                  summary: Customer order history
                  description: All orders for a specific customer
                  value:
                    data:
                      - orderId: "ORD-2026-0109-00042"
                        customerId: "CUST-2026-00042"
                        status: "shipped"
                        priority: "next_day"
                        totalItems: 3
                        totalQuantity: 4
                        totalValue: 144.96
                        waveId: "WAVE-2026-0109-AM-001"
                        createdAt: "2026-01-09T07:22:00Z"
                      - orderId: "ORD-2026-0105-00089"
                        customerId: "CUST-2026-00042"
                        status: "completed"
                        priority: "standard"
                        totalItems: 1
                        totalQuantity: 1
                        totalValue: 89.99
                        waveId: "WAVE-2026-0105-PM-002"
                        createdAt: "2026-01-05T14:30:00Z"
                    pagination:
                      page: 1
                      pageSize: 20
                      total: 2
                      hasMore: false

  /orders/{orderId}:
    get:
      summary: Get order by ID
      description: |
        Retrieve complete order details by order ID.

        Returns full order information including:
        - Order header (customer, addresses, priority)
        - Line items with product details
        - Process path and special handling requirements
        - Current status and wave assignment
        - Timestamps and audit trail
      tags:
        - Orders
      parameters:
        - name: orderId
          in: path
          required: true
          description: Unique order identifier (format ORD-YYYY-MMDD-NNNNN)
          schema:
            type: string
          example: "ORD-2026-0109-00187"
      responses:
        '200':
          description: Order retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
              examples:
                orderInPicking:
                  summary: Order currently in picking
                  description: High-value order assigned to wave and being picked
                  value:
                    orderId: "ORD-2026-0109-00187"
                    customerId: "CUST-2026-00187"
                    status: "picking"
                    priority: "same_day"
                    promisedDeliveryAt: "2026-01-09T20:00:00Z"
                    shippingAddress:
                      street: "1 Infinite Loop"
                      city: "Cupertino"
                      state: "CA"
                      zipCode: "95014"
                      country: "US"
                    items:
                      - sku: "ELEC-LAPTOP-PRO-16"
                        productName: "Professional Laptop 16-inch"
                        quantity: 1
                        unitPrice: 2499.99
                        weight: 2.1
                        isFragile: true
                        pickStatus: "picked"
                      - sku: "ELEC-MOUSE-WRLS"
                        productName: "Wireless Ergonomic Mouse"
                        quantity: 1
                        unitPrice: 79.99
                        weight: 0.12
                        pickStatus: "in_progress"
                    processPath:
                      pathId: "PP-highval-fragile-187"
                      requirements: ["multi_item", "high_value", "fragile"]
                      consolidationRequired: true
                      specialHandling: ["high_value_verification", "fragile_packing"]
                    waveId: "WAVE-2026-0109-AM-001"
                    totalItems: 2
                    totalQuantity: 2
                    totalWeight: 2.22
                    totalValue: 2579.98
                    createdAt: "2026-01-09T08:30:00Z"
                    updatedAt: "2026-01-09T10:45:00Z"
                completedOrder:
                  summary: Completed order
                  description: Order that has been fully fulfilled and delivered
                  value:
                    orderId: "ORD-2026-0105-00089"
                    customerId: "CUST-2026-00042"
                    status: "completed"
                    priority: "standard"
                    promisedDeliveryAt: "2026-01-08T17:00:00Z"
                    deliveredAt: "2026-01-07T14:22:00Z"
                    shippingAddress:
                      street: "221B Baker Street"
                      city: "Boston"
                      state: "MA"
                      zipCode: "02101"
                      country: "US"
                    items:
                      - sku: "HOME-CANDLE-LAVENDER"
                        productName: "Lavender Scented Candle"
                        quantity: 1
                        unitPrice: 24.99
                        weight: 0.5
                    processPath:
                      pathId: "PP-simple-089"
                      requirements: ["single_item"]
                      consolidationRequired: false
                      specialHandling: []
                    waveId: "WAVE-2026-0105-PM-002"
                    shipmentId: "SHIP-2026-0106-00456"
                    trackingNumber: "1Z999AA10123456784"
                    carrier: "UPS"
                    totalItems: 1
                    totalQuantity: 1
                    totalWeight: 0.5
                    totalValue: 24.99
                    createdAt: "2026-01-05T14:30:00Z"
                    updatedAt: "2026-01-07T14:22:00Z"
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                orderNotFound:
                  summary: Order not found
                  value:
                    error: "NOT_FOUND"
                    message: "Order not found: ORD-2026-0109-99999"
                    details:
                      orderId: "ORD-2026-0109-99999"

  /orders/{orderId}/validate:
    put:
      summary: Validate order
      description: |
        Validates an order and reserves inventory.

        ## Validation Checks
        1. All required fields present
        2. Items have valid SKUs in catalog
        3. Inventory available for all items
        4. Shipping address is deliverable
        5. No conflicting item types (e.g., hazmat + cold chain)

        ## On Success
        - Order status changes to `validated`
        - Inventory is soft-reserved
        - Order enters wave assignment queue
      tags:
        - Orders
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          example: "ORD-2026-0109-00001"
      responses:
        '200':
          description: Order validated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
              examples:
                orderValidated:
                  summary: Order successfully validated
                  value:
                    orderId: "ORD-2026-0109-00001"
                    customerId: "CUST-2026-00001"
                    status: "validated"
                    priority: "standard"
                    inventoryReserved: true
                    reservationId: "RES-2026-0109-00001"
                    validatedAt: "2026-01-09T10:16:00Z"
                    totalValue: 12.99
                    createdAt: "2026-01-09T10:15:00Z"
                    updatedAt: "2026-01-09T10:16:00Z"
        '400':
          description: Validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                inventoryUnavailable:
                  summary: Inventory not available
                  value:
                    error: "VALIDATION_FAILED"
                    message: "Inventory validation failed"
                    details:
                      failedItems:
                        - sku: "ELEC-LAPTOP-PRO-16"
                          requested: 1
                          available: 0

  /orders/{orderId}/cancel:
    put:
      summary: Cancel order
      description: |
        Cancels an order and releases any reserved inventory.

        ## Cancellation Rules
        - Orders can be cancelled in statuses: received, validated, assigned_to_wave
        - Orders in `picking` status may be partially cancellable
        - Orders in `packing`, `shipped`, or `completed` cannot be cancelled
        - Cancellation triggers inventory release and refund processing

        ## Common Cancellation Reasons
        - `customer_request`: Customer requested cancellation
        - `payment_failed`: Payment authorization failed
        - `fraud_detected`: Order flagged for fraud
        - `inventory_unavailable`: Items became unavailable
        - `address_undeliverable`: Cannot ship to address
      tags:
        - Orders
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          example: "ORD-2026-0109-00042"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
                  description: Cancellation reason code
                  enum: [customer_request, payment_failed, fraud_detected, inventory_unavailable, address_undeliverable, other]
                notes:
                  type: string
                  description: Additional notes about the cancellation
                cancelledBy:
                  type: string
                  description: User or system that initiated cancellation
            examples:
              customerCancellation:
                summary: Customer requested cancellation
                description: Customer changed their mind before fulfillment
                value:
                  reason: "customer_request"
                  notes: "Customer found item cheaper elsewhere"
                  cancelledBy: "customer-portal"
              fraudCancellation:
                summary: Fraud detection cancellation
                description: Order flagged by fraud prevention system
                value:
                  reason: "fraud_detected"
                  notes: "Multiple failed payment attempts from different cards"
                  cancelledBy: "fraud-detection-service"
              inventoryCancellation:
                summary: Inventory unavailable
                description: Items became unavailable after order placement
                value:
                  reason: "inventory_unavailable"
                  notes: "Inventory discrepancy found during cycle count"
                  cancelledBy: "inventory-service"
      responses:
        '200':
          description: Order cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
              examples:
                orderCancelled:
                  summary: Order successfully cancelled
                  description: Order cancelled before picking started
                  value:
                    orderId: "ORD-2026-0109-00042"
                    customerId: "CUST-2026-00042"
                    status: "cancelled"
                    priority: "next_day"
                    cancellation:
                      reason: "customer_request"
                      notes: "Customer found item cheaper elsewhere"
                      cancelledBy: "customer-portal"
                      cancelledAt: "2026-01-09T11:30:00Z"
                      inventoryReleased: true
                      refundInitiated: true
                      refundAmount: 144.96
                    totalItems: 3
                    totalQuantity: 4
                    totalValue: 144.96
                    createdAt: "2026-01-09T07:22:00Z"
                    updatedAt: "2026-01-09T11:30:00Z"
        '400':
          description: Order cannot be cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                alreadyShipped:
                  summary: Order already shipped
                  value:
                    error: "CANCELLATION_NOT_ALLOWED"
                    message: "Order cannot be cancelled: already shipped"
                    details:
                      orderId: "ORD-2026-0109-00042"
                      currentStatus: "shipped"
                      shipmentId: "SHIP-2026-0109-00123"
                      trackingNumber: "1Z999AA10123456784"
                      suggestion: "Please initiate a return instead"
                partiallyPicked:
                  summary: Order partially picked
                  value:
                    error: "PARTIAL_CANCELLATION_REQUIRED"
                    message: "Order is partially picked. Full cancellation not possible."
                    details:
                      orderId: "ORD-2026-0109-00042"
                      currentStatus: "picking"
                      pickedItems: 2
                      totalItems: 3
                      suggestion: "Use partial cancellation endpoint or wait for completion"

  /health:
    get:
      summary: Health check
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy

  # Reprocessing Endpoints
  /reprocessing/eligible:
    get:
      summary: Get orders eligible for retry
      description: |
        Retrieve orders that are eligible for reprocessing based on retry count and status.

        ## Eligibility Criteria
        - Order must have failed during processing
        - Retry count must be below maxRetries threshold
        - Order must not be in terminal state (completed, cancelled)
        - Sufficient time elapsed since last failure (exponential backoff)

        ## Use Cases
        - **Retry Scheduler**: Query eligible orders for batch reprocessing
        - **Operations Dashboard**: Monitor orders awaiting retry
        - **Alert Systems**: Track orders approaching retry limit
      tags:
        - Reprocessing
      parameters:
        - name: limit
          in: query
          description: Maximum number of orders to return
          schema:
            type: integer
            default: 100
            maximum: 500
        - name: maxRetries
          in: query
          description: Only return orders with retry count below this value
          schema:
            type: integer
            default: 5
        - name: status
          in: query
          description: Filter by specific failure statuses
          schema:
            type: array
            items:
              type: string
      responses:
        '200':
          description: List of eligible orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/EligibleOrderItem'
                  total:
                    type: integer
              examples:
                eligibleOrdersList:
                  summary: Orders eligible for retry
                  description: Orders that failed due to transient errors and can be retried
                  value:
                    data:
                      - orderId: "ORD-2026-0109-00345"
                        customerId: "CUST-2026-00156"
                        status: "validation_failed"
                        retryCount: 2
                        lastFailureReason: "Inventory service timeout"
                        lastFailedAt: "2026-01-09T10:30:00Z"
                        nextRetryAt: "2026-01-09T10:35:00Z"
                        createdAt: "2026-01-09T10:15:00Z"
                      - orderId: "ORD-2026-0109-00289"
                        customerId: "CUST-2026-00089"
                        status: "wave_assignment_failed"
                        retryCount: 1
                        lastFailureReason: "Wave service unavailable"
                        lastFailedAt: "2026-01-09T09:45:00Z"
                        nextRetryAt: "2026-01-09T09:47:00Z"
                        createdAt: "2026-01-09T09:30:00Z"
                      - orderId: "ORD-2026-0109-00412"
                        customerId: "CUST-2026-00234"
                        status: "process_path_failed"
                        retryCount: 4
                        lastFailureReason: "Process path service error: invalid item configuration"
                        lastFailedAt: "2026-01-09T11:00:00Z"
                        nextRetryAt: "2026-01-09T11:30:00Z"
                        createdAt: "2026-01-09T08:00:00Z"
                    total: 3

  /reprocessing/orders/{orderId}/retry-count:
    get:
      summary: Get retry metadata for order
      description: |
        Retrieve retry metadata for a specific order including current retry count,
        failure history, and eligibility for next retry.
      tags:
        - Reprocessing
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          example: "ORD-2026-0109-00345"
      responses:
        '200':
          description: Retry metadata retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RetryMetadata'
              examples:
                eligibleForRetry:
                  summary: Order eligible for retry
                  description: Order with remaining retry attempts
                  value:
                    orderId: "ORD-2026-0109-00345"
                    retryCount: 2
                    maxRetries: 5
                    lastFailureReason: "Inventory service timeout"
                    lastFailedAt: "2026-01-09T10:30:00Z"
                    nextRetryAt: "2026-01-09T10:35:00Z"
                    isEligibleForRetry: true
                    backoffSeconds: 300
                approachingLimit:
                  summary: Order approaching retry limit
                  description: Order with only one retry remaining
                  value:
                    orderId: "ORD-2026-0109-00412"
                    retryCount: 4
                    maxRetries: 5
                    lastFailureReason: "Process path service error: invalid item configuration"
                    lastFailedAt: "2026-01-09T11:00:00Z"
                    nextRetryAt: "2026-01-09T11:30:00Z"
                    isEligibleForRetry: true
                    backoffSeconds: 1800
        '404':
          description: Order not found
    post:
      summary: Increment retry count
      description: |
        Record a failed retry attempt for an order. Updates the retry count
        and stores the failure reason for diagnostics.

        ## Automatic Actions
        - Increments retry counter
        - Records failure timestamp and reason
        - Calculates next retry time with exponential backoff
        - If max retries exceeded, marks order for DLQ
      tags:
        - Reprocessing
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          example: "ORD-2026-0109-00345"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - failureReason
              properties:
                failureReason:
                  type: string
                  description: Description of why the retry failed
                failedAt:
                  type: string
                  format: date-time
                  description: Timestamp of failure (defaults to now)
            examples:
              serviceTimeout:
                summary: Service timeout failure
                value:
                  failureReason: "Inventory service timeout after 30s"
                  failedAt: "2026-01-09T10:35:00Z"
              validationError:
                summary: Validation error
                value:
                  failureReason: "Item SKU ELEC-LAPTOP-PRO-16 not found in catalog"
                  failedAt: "2026-01-09T10:40:00Z"
      responses:
        '200':
          description: Retry count incremented
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RetryMetadata'
              examples:
                retryCountUpdated:
                  summary: Retry count incremented
                  value:
                    orderId: "ORD-2026-0109-00345"
                    retryCount: 3
                    maxRetries: 5
                    lastFailureReason: "Inventory service timeout after 30s"
                    lastFailedAt: "2026-01-09T10:35:00Z"
                    nextRetryAt: "2026-01-09T10:45:00Z"
                    isEligibleForRetry: true
                    backoffSeconds: 600
                maxRetriesReached:
                  summary: Max retries exceeded
                  value:
                    orderId: "ORD-2026-0109-00412"
                    retryCount: 5
                    maxRetries: 5
                    lastFailureReason: "Process path service error: invalid item configuration"
                    lastFailedAt: "2026-01-09T11:30:00Z"
                    nextRetryAt: null
                    isEligibleForRetry: false
                    requiresDLQ: true

  /reprocessing/orders/{orderId}/reset:
    post:
      summary: Reset order for retry
      description: |
        Reset order status to allow reprocessing from the beginning.
        Clears retry count and failure history, returning order to initial state.

        ## Use Cases
        - Manual intervention after fixing underlying issue
        - Data correction before re-attempting fulfillment
        - Recovery from DLQ after root cause resolution

        ## Caution
        This operation clears all retry metadata. Only use after
        confirming the root cause has been addressed.
      tags:
        - Reprocessing
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          example: "ORD-2026-0109-00412"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                resetReason:
                  type: string
                  description: Reason for resetting the order
                resetBy:
                  type: string
                  description: User or system initiating reset
            examples:
              manualReset:
                summary: Manual reset after fix
                value:
                  resetReason: "Item configuration corrected in catalog"
                  resetBy: "ops-team@example.com"
      responses:
        '200':
          description: Order reset successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
              examples:
                orderReset:
                  summary: Order reset to initial state
                  value:
                    orderId: "ORD-2026-0109-00412"
                    customerId: "CUST-2026-00234"
                    status: "received"
                    priority: "standard"
                    retryMetadata:
                      retryCount: 0
                      resetAt: "2026-01-09T12:00:00Z"
                      resetBy: "ops-team@example.com"
                      resetReason: "Item configuration corrected in catalog"
                    totalValue: 259.97
                    createdAt: "2026-01-09T08:00:00Z"
                    updatedAt: "2026-01-09T12:00:00Z"
        '404':
          description: Order not found

  /reprocessing/orders/{orderId}/dlq:
    post:
      summary: Move order to dead letter queue
      description: |
        Move a failed order to the dead letter queue after max retries exceeded
        or when manual escalation is required.

        ## When to Use
        - Automatic: After retry limit exceeded
        - Manual: Persistent failures requiring human intervention
        - Urgent: Customer-impacting issues needing immediate escalation

        ## DLQ Entry Contents
        - Full order snapshot at time of failure
        - Complete retry history
        - Failure details for root cause analysis
      tags:
        - Reprocessing
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
          example: "ORD-2026-0109-00412"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - failureStatus
                - failureReason
              properties:
                failureStatus:
                  type: string
                  description: Final failure status code
                  enum: [validation_failed, inventory_failed, wave_assignment_failed, process_path_failed, system_error]
                failureReason:
                  type: string
                  description: Detailed failure explanation
                escalationLevel:
                  type: string
                  enum: [normal, high, critical]
                  default: normal
            examples:
              maxRetriesExceeded:
                summary: Max retries exceeded
                description: Order moved to DLQ after exhausting retry attempts
                value:
                  failureStatus: "process_path_failed"
                  failureReason: "Process path service consistently failing: invalid hazmat configuration for SKU AUTO-BATT-12V-AGM"
                  escalationLevel: "normal"
              manualEscalation:
                summary: Manual escalation
                description: Ops team escalating high-value stuck order
                value:
                  failureStatus: "inventory_failed"
                  failureReason: "Inventory discrepancy - system shows 5 units but physical count is 0"
                  escalationLevel: "critical"
      responses:
        '200':
          description: Order moved to DLQ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DLQEntry'
              examples:
                orderInDLQ:
                  summary: Order successfully moved to DLQ
                  value:
                    orderId: "ORD-2026-0109-00412"
                    customerId: "CUST-2026-00234"
                    failureStatus: "process_path_failed"
                    failureReason: "Process path service consistently failing: invalid hazmat configuration"
                    retryCount: 5
                    resolved: false
                    escalationLevel: "normal"
                    createdAt: "2026-01-09T12:15:00Z"

  # Dead Letter Queue Endpoints
  /dead-letter-queue:
    get:
      summary: List dead letter queue entries
      description: |
        Retrieve failed orders from the dead letter queue with optional filtering.

        ## Purpose
        The Dead Letter Queue (DLQ) contains orders that could not be processed
        after exhausting all retry attempts. These require manual investigation
        and resolution.

        ## Filtering Options
        - **resolved**: Show resolved/unresolved entries
        - **failureStatus**: Filter by specific failure type
        - **olderThanHours**: Find stale entries needing attention
        - **customerId**: Customer-specific investigation

        ## Resolution Workflow
        1. Investigate root cause using failure details
        2. Fix underlying issue (data, configuration, etc.)
        3. Resolve entry with appropriate action (retry, cancel, escalate)
      tags:
        - Dead Letter Queue
      parameters:
        - name: resolved
          in: query
          description: Filter by resolution status (true=resolved, false=unresolved)
          schema:
            type: boolean
        - name: failureStatus
          in: query
          description: Filter by failure status code
          schema:
            type: string
            enum: [validation_failed, inventory_failed, wave_assignment_failed, process_path_failed, system_error]
        - name: customerId
          in: query
          description: Filter by customer ID
          schema:
            type: string
        - name: olderThanHours
          in: query
          description: Filter entries older than N hours (for SLA monitoring)
          schema:
            type: number
        - name: limit
          in: query
          description: Maximum entries to return
          schema:
            type: integer
            default: 50
            maximum: 200
        - name: offset
          in: query
          description: Pagination offset
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: DLQ entries retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DLQEntry'
                  total:
                    type: integer
              examples:
                unresolvedEntries:
                  summary: Unresolved DLQ entries
                  description: Orders awaiting manual resolution
                  value:
                    data:
                      - orderId: "ORD-2026-0109-00412"
                        customerId: "CUST-2026-00234"
                        failureStatus: "process_path_failed"
                        failureReason: "Process path service error: invalid hazmat configuration"
                        retryCount: 5
                        resolved: false
                        escalationLevel: "normal"
                        ageHours: 2.5
                        createdAt: "2026-01-09T09:45:00Z"
                      - orderId: "ORD-2026-0108-00789"
                        customerId: "CUST-2026-00156"
                        failureStatus: "inventory_failed"
                        failureReason: "Persistent inventory discrepancy for SKU ELEC-LAPTOP-PRO-16"
                        retryCount: 5
                        resolved: false
                        escalationLevel: "high"
                        ageHours: 26.5
                        createdAt: "2026-01-08T08:30:00Z"
                      - orderId: "ORD-2026-0108-00654"
                        customerId: "CUST-2026-00089"
                        failureStatus: "validation_failed"
                        failureReason: "Address validation failed: undeliverable postal code"
                        retryCount: 5
                        resolved: false
                        escalationLevel: "normal"
                        ageHours: 28.0
                        createdAt: "2026-01-08T07:00:00Z"
                    total: 3
                resolvedEntries:
                  summary: Resolved DLQ entries
                  description: Recently resolved entries for audit
                  value:
                    data:
                      - orderId: "ORD-2026-0107-00234"
                        customerId: "CUST-2026-00045"
                        failureStatus: "system_error"
                        failureReason: "Database connection pool exhausted"
                        retryCount: 5
                        resolved: true
                        resolution: "manual_retry"
                        resolvedBy: "ops-team@example.com"
                        resolvedAt: "2026-01-08T14:00:00Z"
                        notes: "Connection pool issue fixed, order reprocessed successfully"
                        createdAt: "2026-01-07T16:30:00Z"
                    total: 1

  /dead-letter-queue/stats:
    get:
      summary: Get DLQ statistics
      description: |
        Retrieve aggregated statistics about dead letter queue entries.

        ## Metrics Provided
        - Total entries (resolved and unresolved)
        - Breakdown by failure status
        - Breakdown by resolution type
        - Age of oldest unresolved entry (for SLA monitoring)

        ## Use Cases
        - **Operations Dashboard**: Real-time DLQ health monitoring
        - **Alerting**: SLA breach detection based on age thresholds
        - **Capacity Planning**: Track failure patterns over time
      tags:
        - Dead Letter Queue
      responses:
        '200':
          description: DLQ stats retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DLQStats'
              examples:
                healthyStats:
                  summary: Healthy DLQ state
                  description: Low unresolved count, recent oldest entry
                  value:
                    totalEntries: 15
                    unresolvedCount: 3
                    resolvedCount: 12
                    byFailureStatus:
                      validation_failed: 4
                      inventory_failed: 5
                      wave_assignment_failed: 2
                      process_path_failed: 3
                      system_error: 1
                    byResolution:
                      manual_retry: 8
                      cancelled: 3
                      escalated: 1
                    oldestUnresolvedAt: "2026-01-09T09:45:00Z"
                    oldestUnresolvedAgeHours: 2.5
                criticalStats:
                  summary: Critical DLQ state
                  description: High unresolved count, stale entries requiring attention
                  value:
                    totalEntries: 47
                    unresolvedCount: 23
                    resolvedCount: 24
                    byFailureStatus:
                      validation_failed: 8
                      inventory_failed: 18
                      wave_assignment_failed: 5
                      process_path_failed: 12
                      system_error: 4
                    byResolution:
                      manual_retry: 15
                      cancelled: 6
                      escalated: 3
                    oldestUnresolvedAt: "2026-01-07T14:30:00Z"
                    oldestUnresolvedAgeHours: 45.5

  /dead-letter-queue/{orderId}:
    get:
      summary: Get specific DLQ entry
      description: |
        Retrieve detailed information about a specific DLQ entry including
        the full order snapshot and complete failure history.
      tags:
        - Dead Letter Queue
      parameters:
        - name: orderId
          in: path
          required: true
          description: Order ID of the DLQ entry
          schema:
            type: string
          example: "ORD-2026-0109-00412"
      responses:
        '200':
          description: DLQ entry retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DLQEntry'
              examples:
                unresolvedEntry:
                  summary: Unresolved DLQ entry
                  description: Entry awaiting manual resolution with full order details
                  value:
                    orderId: "ORD-2026-0109-00412"
                    customerId: "CUST-2026-00234"
                    failureStatus: "process_path_failed"
                    failureReason: "Process path service error: invalid hazmat configuration for SKU AUTO-BATT-12V-AGM"
                    retryCount: 5
                    retryHistory:
                      - attempt: 1
                        failedAt: "2026-01-09T08:15:00Z"
                        reason: "Process path service timeout"
                      - attempt: 2
                        failedAt: "2026-01-09T08:20:00Z"
                        reason: "Process path service timeout"
                      - attempt: 3
                        failedAt: "2026-01-09T08:30:00Z"
                        reason: "Process path service error: invalid hazmat configuration"
                      - attempt: 4
                        failedAt: "2026-01-09T09:00:00Z"
                        reason: "Process path service error: invalid hazmat configuration"
                      - attempt: 5
                        failedAt: "2026-01-09T09:45:00Z"
                        reason: "Process path service error: invalid hazmat configuration"
                    originalOrder:
                      orderId: "ORD-2026-0109-00412"
                      customerId: "CUST-2026-00234"
                      priority: "standard"
                      items:
                        - sku: "AUTO-BATT-12V-AGM"
                          productName: "AGM Car Battery 12V 800CCA"
                          quantity: 1
                          unitPrice: 189.99
                          isHazmat: true
                      totalValue: 189.99
                    resolved: false
                    escalationLevel: "normal"
                    createdAt: "2026-01-09T09:45:00Z"
                resolvedEntry:
                  summary: Resolved DLQ entry
                  description: Entry that was successfully resolved via manual retry
                  value:
                    orderId: "ORD-2026-0107-00234"
                    customerId: "CUST-2026-00045"
                    failureStatus: "system_error"
                    failureReason: "Database connection pool exhausted"
                    retryCount: 5
                    resolved: true
                    resolution: "manual_retry"
                    resolvedBy: "ops-team@example.com"
                    resolvedAt: "2026-01-08T14:00:00Z"
                    notes: "Connection pool issue fixed, order reprocessed successfully"
                    createdAt: "2026-01-07T16:30:00Z"
                    updatedAt: "2026-01-08T14:00:00Z"
        '404':
          description: DLQ entry not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                notFound:
                  summary: Entry not found
                  value:
                    error: "NOT_FOUND"
                    message: "DLQ entry not found for order: ORD-2026-0109-99999"

  /dead-letter-queue/{orderId}/resolve:
    patch:
      summary: Resolve DLQ entry
      description: |
        Mark a dead letter queue entry as resolved with resolution details.

        ## Resolution Types
        - **manual_retry**: Order was fixed and reprocessed successfully
        - **cancelled**: Order was cancelled and customer refunded
        - **escalated**: Issue escalated to engineering or external team

        ## Best Practices
        - Always include detailed notes for audit trail
        - For manual_retry, confirm order completed before resolving
        - For cancelled, ensure customer communication completed
      tags:
        - Dead Letter Queue
      parameters:
        - name: orderId
          in: path
          required: true
          description: Order ID of the DLQ entry to resolve
          schema:
            type: string
          example: "ORD-2026-0109-00412"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - resolution
                - resolvedBy
              properties:
                resolution:
                  type: string
                  description: Resolution action taken
                  enum: [manual_retry, cancelled, escalated]
                notes:
                  type: string
                  description: Detailed notes about the resolution
                resolvedBy:
                  type: string
                  description: Email or ID of person/system resolving
            examples:
              manualRetryResolution:
                summary: Manual retry resolution
                description: Order fixed and successfully reprocessed
                value:
                  resolution: "manual_retry"
                  notes: "Hazmat configuration corrected in catalog for SKU AUTO-BATT-12V-AGM. Order reprocessed and shipped successfully."
                  resolvedBy: "ops-team@example.com"
              cancelledResolution:
                summary: Cancelled resolution
                description: Order could not be fulfilled, customer refunded
                value:
                  resolution: "cancelled"
                  notes: "Item permanently out of stock. Customer contacted and full refund issued. Order ID: REFUND-2026-00456"
                  resolvedBy: "customer-service@example.com"
              escalatedResolution:
                summary: Escalated resolution
                description: Issue requires engineering investigation
                value:
                  resolution: "escalated"
                  notes: "Persistent integration failure with process-path-service. JIRA ticket PLAT-4567 created for engineering team."
                  resolvedBy: "ops-lead@example.com"
      responses:
        '200':
          description: DLQ entry resolved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DLQEntry'
              examples:
                entryResolved:
                  summary: Entry successfully resolved
                  value:
                    orderId: "ORD-2026-0109-00412"
                    customerId: "CUST-2026-00234"
                    failureStatus: "process_path_failed"
                    failureReason: "Process path service error: invalid hazmat configuration"
                    retryCount: 5
                    resolved: true
                    resolution: "manual_retry"
                    resolvedBy: "ops-team@example.com"
                    resolvedAt: "2026-01-09T14:30:00Z"
                    notes: "Hazmat configuration corrected in catalog for SKU AUTO-BATT-12V-AGM. Order reprocessed and shipped successfully."
                    createdAt: "2026-01-09T09:45:00Z"
                    updatedAt: "2026-01-09T14:30:00Z"
        '400':
          description: Invalid resolution request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                alreadyResolved:
                  summary: Entry already resolved
                  value:
                    error: "ALREADY_RESOLVED"
                    message: "DLQ entry already resolved"
                    details:
                      orderId: "ORD-2026-0109-00412"
                      resolvedAt: "2026-01-09T14:30:00Z"
                      resolvedBy: "ops-team@example.com"
        '404':
          description: DLQ entry not found

components:
  schemas:
    CreateOrderRequest:
      type: object
      required:
        - customerId
        - priority
        - shippingAddress
        - items
      properties:
        customerId:
          type: string
        priority:
          type: string
          enum: [same_day, next_day, standard]
        promisedDeliveryAt:
          type: string
          format: date-time
        shippingAddress:
          $ref: '#/components/schemas/Address'
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItemInput'

    OrderItemInput:
      type: object
      required:
        - sku
        - quantity
        - unitPrice
      properties:
        sku:
          type: string
        quantity:
          type: integer
        unitPrice:
          type: number

    OrderResponse:
      type: object
      properties:
        orderId:
          type: string
        customerId:
          type: string
        status:
          type: string
        priority:
          type: string
        promisedDeliveryAt:
          type: string
          format: date-time
        shippingAddress:
          $ref: '#/components/schemas/Address'
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        totalItems:
          type: integer
        totalQuantity:
          type: integer
        totalWeight:
          type: number
        totalValue:
          type: number
        waveId:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    OrderItem:
      type: object
      properties:
        sku:
          type: string
        productName:
          type: string
        quantity:
          type: integer
        unitPrice:
          type: number
        weight:
          type: number

    OrderListItem:
      type: object
      properties:
        orderId:
          type: string
        customerId:
          type: string
        status:
          type: string
        priority:
          type: string
        totalItems:
          type: integer
        totalQuantity:
          type: integer
        waveId:
          type: string
        createdAt:
          type: string
          format: date-time

    Address:
      type: object
      required:
        - street
        - city
        - state
        - zipCode
        - country
      properties:
        street:
          type: string
        street2:
          type: string
        city:
          type: string
        state:
          type: string
        zipCode:
          type: string
        country:
          type: string

    EligibleOrderItem:
      type: object
      properties:
        orderId:
          type: string
        customerId:
          type: string
        status:
          type: string
        retryCount:
          type: integer
        lastFailureReason:
          type: string
        lastFailedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time

    RetryMetadata:
      type: object
      properties:
        orderId:
          type: string
        retryCount:
          type: integer
        maxRetries:
          type: integer
        lastFailureReason:
          type: string
        lastFailedAt:
          type: string
          format: date-time
        nextRetryAt:
          type: string
          format: date-time
        isEligibleForRetry:
          type: boolean

    DLQEntry:
      type: object
      properties:
        orderId:
          type: string
        customerId:
          type: string
        failureStatus:
          type: string
        failureReason:
          type: string
        retryCount:
          type: integer
        originalOrder:
          $ref: '#/components/schemas/OrderResponse'
        resolved:
          type: boolean
        resolution:
          type: string
          enum: [manual_retry, cancelled, escalated]
        resolvedBy:
          type: string
        resolvedAt:
          type: string
          format: date-time
        notes:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    DLQStats:
      type: object
      description: Aggregated statistics for the Dead Letter Queue
      properties:
        totalEntries:
          type: integer
          description: Total number of entries in DLQ (resolved + unresolved)
        unresolvedCount:
          type: integer
          description: Number of entries awaiting resolution
        resolvedCount:
          type: integer
          description: Number of resolved entries
        byFailureStatus:
          type: object
          description: Count of entries by failure status
          additionalProperties:
            type: integer
        byResolution:
          type: object
          description: Count of resolved entries by resolution type
          additionalProperties:
            type: integer
        oldestUnresolvedAt:
          type: string
          format: date-time
          description: Timestamp of oldest unresolved entry (for SLA monitoring)

    ErrorResponse:
      type: object
      description: Standard error response format
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error code (e.g., VALIDATION_ERROR, NOT_FOUND, BUSINESS_RULE_VIOLATION)
          example: "VALIDATION_ERROR"
        message:
          type: string
          description: Human-readable error description
          example: "Missing required field: shippingAddress"
        details:
          type: object
          description: Additional error context (structure varies by error type)
          additionalProperties: true

  parameters:
    WMSCorrelationID:
      name: X-WMS-Correlation-ID
      in: header
      description: CloudEvents extension for distributed tracing and correlation across WMS services
      required: false
      schema:
        type: string
        format: uuid
      example: "550e8400-e29b-41d4-a716-446655440000"

    WMSWaveNumber:
      name: X-WMS-Wave-Number
      in: header
      description: CloudEvents extension for wave-based processing correlation
      required: false
      schema:
        type: string
      example: "WAVE-2024-00123"

    WMSWorkflowID:
      name: X-WMS-Workflow-ID
      in: header
      description: CloudEvents extension for Temporal workflow correlation
      required: false
      schema:
        type: string
      example: "order-fulfillment-ORD-12345"
